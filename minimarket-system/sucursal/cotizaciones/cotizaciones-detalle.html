<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sucursal - Detalle de Cotizaci√≥n</title>
  <link rel="stylesheet" href="../assets/css/variables.css" />
  <link rel="stylesheet" href="../assets/css/layout.css" />
  <link rel="stylesheet" href="../assets/css/components.css" />
  <link rel="stylesheet" href="../assets/css/pages.css" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="/minimarket-system/shared/js/utils.js"></script>
  <script src="/minimarket-system/shared/js/validation.js"></script>
  <script src="/minimarket-system/shared/js/notifications.js"></script>
  <script src="/minimarket-system/shared/js/api.js"></script>
  <script src="/minimarket-system/shared/js/auth.js"></script>
  <script src="../assets/js/main.js"></script>
  <style>
    @media print {
      .no-print {
        display: none !important;
      }
      
      body {
        background: white !important;
      }
      
      .main {
        margin: 0 !important;
        padding: 0 !important;
      }
      
      .cotizacion-documento {
        box-shadow: none !important;
        border: none !important;
        page-break-after: always;
      }
    }
    
    .cotizacion-documento {
      background: white;
      padding: 40px;
      margin: 20px auto;
      max-width: 900px;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      border-radius: 8px;
    }
    
    .cotizacion-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 3px solid var(--color-primary);
    }
    
    .empresa-info {
      flex: 1;
    }
    
    .empresa-logo {
      width: 120px;
      height: 120px;
      background: var(--color-surface);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      margin-bottom: 15px;
    }
    
    .cotizacion-info {
      background: var(--color-surface);
      padding: 20px;
      border-radius: 8px;
      min-width: 250px;
    }
    
    .cotizacion-numero {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--color-primary);
      margin-bottom: 10px;
    }
    
    .cliente-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
      padding: 20px;
      background: var(--color-surface);
      border-radius: 8px;
    }
    
    .section-title {
      font-weight: 600;
      color: var(--color-primary);
      margin-bottom: 15px;
      font-size: 1.1rem;
      border-bottom: 2px solid var(--color-border);
      padding-bottom: 5px;
    }
    
    .info-row {
      display: flex;
      margin-bottom: 8px;
    }
    
    .info-label {
      font-weight: 600;
      min-width: 120px;
      color: var(--color-text-muted);
    }
    
    .info-value {
      flex: 1;
    }
    
    .tabla-detalle {
      width: 100%;
      margin-bottom: 30px;
      border-collapse: collapse;
    }
    
    .tabla-detalle thead {
      background: var(--color-primary);
      color: white;
    }
    
    .tabla-detalle th {
      padding: 12px;
      text-align: left;
      font-weight: 600;
    }
    
    .tabla-detalle td {
      padding: 10px 12px;
      border-bottom: 1px solid var(--color-border);
    }
    
    .tabla-detalle tbody tr:hover {
      background: var(--color-surface);
    }
    
    .tabla-detalle tfoot {
      font-weight: 600;
    }
    
    .tabla-detalle tfoot td {
      border-top: 2px solid var(--color-border);
      padding: 10px 12px;
    }
    
    .totales-section {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 30px;
    }
    
    .totales-box {
      min-width: 350px;
      background: var(--color-surface);
      padding: 20px;
      border-radius: 8px;
    }
    
    .total-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid var(--color-border);
    }
    
    .total-final {
      font-size: 1.3rem;
      color: var(--color-primary);
      border-top: 2px solid var(--color-primary);
      border-bottom: none;
      padding-top: 15px;
      margin-top: 10px;
    }
    
    .condiciones-section {
      margin-top: 30px;
      padding: 20px;
      background: var(--color-surface);
      border-radius: 8px;
    }
    
    .condiciones-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 15px;
    }
    
    .firma-section {
      margin-top: 50px;
      display: flex;
      justify-content: space-around;
      padding-top: 30px;
      border-top: 2px solid var(--color-border);
    }
    
    .firma-box {
      text-align: center;
      min-width: 200px;
    }
    
    .firma-linea {
      border-top: 2px solid #333;
      margin-bottom: 10px;
    }
    
    .pie-documento {
      text-align: center;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid var(--color-border);
      color: var(--color-text-muted);
      font-size: 0.9rem;
    }
    
    .estado-badge-large {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: 600;
      font-size: 1rem;
    }
    
    .estado-pendiente {
      background: #fff3cd;
      color: #856404;
      border: 2px solid #ffc107;
    }
    
    .estado-aprobada {
      background: #d4edda;
      color: #155724;
      border: 2px solid #28a745;
    }
    
    .estado-rechazada {
      background: #f8d7da;
      color: #721c24;
      border: 2px solid #dc3545;
    }
    
    .estado-vencida {
      background: #e2e3e5;
      color: #383d41;
      border: 2px solid #6c757d;
    }
  </style>
</head>
<body class="page cotizaciones-detalle-page">
  <div id="navbar" class="no-print"></div>
  <div id="sidebar" class="no-print"></div>
  
  <main class="main">
    <div class="content">
      <!-- Acciones superiores -->
      <div class="page-header mb-4 no-print">
        <div>
          <h1 class="text-xl fw-600">Detalle de Cotizaci√≥n</h1>
          <p class="text-muted text-sm">Informaci√≥n completa de la cotizaci√≥n</p>
        </div>
        <div>
          <button class="btn btn-secondary" onclick="volver()">
            Volver
          </button>
          <button class="btn btn-info" onclick="enviarEmail()">
            Enviar Email
          </button>
          <button class="btn btn-success" onclick="enviarWhatsApp()">
            Enviar WhatsApp
          </button>
          <button class="btn btn-warning" onclick="descargarPDF()">
            Descargar PDF
          </button>
          <button class="btn btn-primary" onclick="window.print()">
            Imprimir
          </button>
        </div>
      </div>

      <!-- Alertas de estado -->
      <div id="alertaEstado" class="no-print"></div>

      <!-- Documento de Cotizaci√≥n -->
      <div class="cotizacion-documento">
        <!-- Encabezado -->
        <div class="cotizacion-header">
          <div class="empresa-info">
            <div class="empresa-logo">üè™</div>
            <h2 style="margin: 0 0 5px 0; font-size: 1.5rem; color: var(--color-primary);">
              MINIMARKET SYSTEM
            </h2>
            <p style="margin: 0; color: var(--color-text-muted);">
              <strong>RUC:</strong> 20123456789<br>
              <strong>Direcci√≥n:</strong> Av. Principal 123, San Isidro, Lima<br>
              <strong>Tel√©fono:</strong> (01) 234-5678 | <strong>Email:</strong> ventas@minimarket.com<br>
              <strong>Web:</strong> www.minimarket.com
            </p>
          </div>
          <div class="cotizacion-info">
            <div class="cotizacion-numero">COT-00156</div>
            <div style="margin-bottom: 10px;">
              <span class="estado-badge-large estado-pendiente">PENDIENTE</span>
            </div>
            <div style="font-size: 0.9rem; color: var(--color-text-muted);">
              <strong>Fecha Emisi√≥n:</strong><br>
              25 de Octubre, 2025<br><br>
              <strong>V√°lido Hasta:</strong><br>
              08 de Noviembre, 2025<br>
              <span style="color: #ffc107;">(14 d√≠as)</span>
            </div>
          </div>
        </div>

        <!-- Informaci√≥n del Cliente y Cotizaci√≥n -->
        <div class="cliente-section">
          <div>
            <div class="section-title">DATOS DEL CLIENTE</div>
            <div class="info-row">
              <span class="info-label">Cliente:</span>
              <span class="info-value"><strong>Juan P√©rez Garc√≠a</strong></span>
            </div>
            <div class="info-row">
              <span class="info-label">Documento:</span>
              <span class="info-value">DNI: 45678912</span>
            </div>
            <div class="info-row">
              <span class="info-label">Tel√©fono:</span>
              <span class="info-value">987-654-321</span>
            </div>
            <div class="info-row">
              <span class="info-label">Email:</span>
              <span class="info-value">juan.perez@email.com</span>
            </div>
            <div class="info-row">
              <span class="info-label">Direcci√≥n:</span>
              <span class="info-value">Av. Los Olivos 456, Lima</span>
            </div>
          </div>
          <div>
            <div class="section-title">DATOS DE LA COTIZACI√ìN</div>
            <div class="info-row">
              <span class="info-label">N¬∞ Cotizaci√≥n:</span>
              <span class="info-value"><strong>COT-00156</strong></span>
            </div>
            <div class="info-row">
              <span class="info-label">Vendedor:</span>
              <span class="info-value">Carlos Mendoza</span>
            </div>
            <div class="info-row">
              <span class="info-label">Fecha Emisi√≥n:</span>
              <span class="info-value">25/10/2025</span>
            </div>
            <div class="info-row">
              <span class="info-label">V√°lido Hasta:</span>
              <span class="info-value">08/11/2025</span>
            </div>
            <div class="info-row">
              <span class="info-label">D√≠as de Validez:</span>
              <span class="info-value">15 d√≠as</span>
            </div>
          </div>
        </div>

        <!-- Detalle de Productos -->
        <div class="section-title" style="margin-bottom: 15px;">DETALLE DE PRODUCTOS</div>
        <table class="tabla-detalle">
          <thead>
            <tr>
              <th style="width: 50px;">#</th>
              <th style="width: 100px;">C√≥digo</th>
              <th>Descripci√≥n</th>
              <th style="width: 80px; text-align: center;">Cant.</th>
              <th style="width: 100px; text-align: right;">P. Unit.</th>
              <th style="width: 80px; text-align: center;">Desc. %</th>
              <th style="width: 120px; text-align: right;">Subtotal</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>PROD001</td>
              <td><strong>Arroz Extra 1kg</strong></td>
              <td style="text-align: center;">20</td>
              <td style="text-align: right;">S/ 4.50</td>
              <td style="text-align: center;">10%</td>
              <td style="text-align: right;"><strong>S/ 81.00</strong></td>
            </tr>
            <tr>
              <td>2</td>
              <td>PROD002</td>
              <td><strong>Aceite Vegetal 1L</strong></td>
              <td style="text-align: center;">15</td>
              <td style="text-align: right;">S/ 12.50</td>
              <td style="text-align: center;">5%</td>
              <td style="text-align: right;"><strong>S/ 178.13</strong></td>
            </tr>
            <tr>
              <td>3</td>
              <td>PROD003</td>
              <td><strong>Coca Cola 2L</strong></td>
              <td style="text-align: center;">30</td>
              <td style="text-align: right;">S/ 7.50</td>
              <td style="text-align: center;">0%</td>
              <td style="text-align: right;"><strong>S/ 225.00</strong></td>
            </tr>
            <tr>
              <td>4</td>
              <td>PROD004</td>
              <td><strong>Leche Gloria 1L</strong></td>
              <td style="text-align: center;">25</td>
              <td style="text-align: right;">S/ 5.20</td>
              <td style="text-align: center;">0%</td>
              <td style="text-align: right;"><strong>S/ 130.00</strong></td>
            </tr>
            <tr>
              <td>5</td>
              <td>PROD005</td>
              <td><strong>Detergente Ace 1kg</strong></td>
              <td style="text-align: center;">10</td>
              <td style="text-align: right;">S/ 15.80</td>
              <td style="text-align: center;">0%</td>
              <td style="text-align: right;"><strong>S/ 158.00</strong></td>
            </tr>
            <tr>
              <td>6</td>
              <td>PROD006</td>
              <td><strong>Papas Lays 150g</strong></td>
              <td style="text-align: center;">40</td>
              <td style="text-align: right;">S/ 3.50</td>
              <td style="text-align: center;">5%</td>
              <td style="text-align: right;"><strong>S/ 133.00</strong></td>
            </tr>
            <tr>
              <td>7</td>
              <td>PROD007</td>
              <td><strong>Az√∫car Rubia 1kg</strong></td>
              <td style="text-align: center;">30</td>
              <td style="text-align: right;">S/ 3.80</td>
              <td style="text-align: center;">0%</td>
              <td style="text-align: right;"><strong>S/ 114.00</strong></td>
            </tr>
            <tr>
              <td>8</td>
              <td>PROD008</td>
              <td><strong>Fideo Don Vittorio 1kg</strong></td>
              <td style="text-align: center;">35</td>
              <td style="text-align: right;">S/ 4.20</td>
              <td style="text-align: center;">0%</td>
              <td style="text-align: right;"><strong>S/ 147.00</strong></td>
            </tr>
          </tbody>
        </table>

        <!-- Totales -->
        <div class="totales-section">
          <div class="totales-box">
            <div class="total-row">
              <span>Subtotal:</span>
              <strong>S/ 1,210.00</strong>
            </div>
            <div class="total-row">
              <span>Descuento:</span>
              <strong style="color: #dc3545;">- S/ 43.87</strong>
            </div>
            <div class="total-row">
              <span>Base Imponible:</span>
              <strong>S/ 1,166.13</strong>
            </div>
            <div class="total-row">
              <span>IGV (18%):</span>
              <strong>S/ 209.90</strong>
            </div>
            <div class="total-row total-final">
              <span>TOTAL A PAGAR:</span>
              <strong>S/ 1,376.03</strong>
            </div>
          </div>
        </div>

        <!-- Observaciones -->
        <div class="condiciones-section" style="margin-bottom: 20px;">
          <div class="section-title">OBSERVACIONES</div>
          <p style="margin: 10px 0; line-height: 1.6;">
            Cotizaci√≥n solicitada para abastecimiento mensual. Cliente preferencial con descuento especial en productos seleccionados.
          </p>
        </div>

        <!-- Condiciones Comerciales -->
        <div class="condiciones-section">
          <div class="section-title">CONDICIONES COMERCIALES</div>
          <div class="condiciones-grid">
            <div>
              <strong>Forma de Pago:</strong><br>
              Efectivo / Transferencia
            </div>
            <div>
              <strong>Tiempo de Entrega:</strong><br>
              24 a 48 horas
            </div>
            <div>
              <strong>Lugar de Entrega:</strong><br>
              Av. Los Olivos 456, Lima
            </div>
            <div>
              <strong>Garant√≠a:</strong><br>
              30 d√≠as en productos cerrados
            </div>
          </div>
        </div>

        <!-- T√©rminos y Condiciones -->
        <div class="condiciones-section">
          <div class="section-title">T√âRMINOS Y CONDICIONES</div>
          <ol style="margin: 10px 0; padding-left: 20px; line-height: 1.8;">
            <li>Los precios est√°n expresados en Soles (S/) e incluyen IGV.</li>
            <li>Esta cotizaci√≥n tiene una validez de 15 d√≠as a partir de la fecha de emisi√≥n.</li>
            <li>Los precios est√°n sujetos a disponibilidad de stock.</li>
            <li>La entrega se realizar√° dentro de las 24-48 horas de confirmada la orden.</li>
            <li>El pago deber√° efectuarse al momento de la entrega o seg√∫n lo acordado.</li>
            <li>Los productos deben ser revisados al momento de la entrega.</li>
            <li>No se aceptan devoluciones de productos abiertos o en mal estado por uso inadecuado.</li>
            <li>La garant√≠a aplica solo para productos con defectos de f√°brica.</li>
          </ol>
        </div>

        <!-- Notas Adicionales -->
        <div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-left: 4px solid var(--color-primary); border-radius: 4px;">
          <strong style="color: var(--color-primary);">Notas Importantes:</strong><br>
          <ul style="margin: 10px 0; padding-left: 20px;">
            <li>Contamos con servicio de delivery sin costo adicional para compras mayores a S/ 1,000.00</li>
            <li>Aceptamos tarjetas de cr√©dito y d√©bito (Visa, Mastercard)</li>
            <li>Descuentos especiales para compras al por mayor</li>
          </ul>
        </div>

        <!-- Firma -->
        <div class="firma-section">
          <div class="firma-box">
            <div class="firma-linea"></div>
            <strong>Carlos Mendoza</strong><br>
            <span style="color: var(--color-text-muted);">Vendedor</span><br>
            <span style="color: var(--color-text-muted); font-size: 0.9rem;">Minimarket System</span>
          </div>
          <div class="firma-box">
            <div class="firma-linea"></div>
            <strong>Juan P√©rez Garc√≠a</strong><br>
            <span style="color: var(--color-text-muted);">Cliente</span><br>
            <span style="color: var(--color-text-muted); font-size: 0.9rem;">DNI: 45678912</span>
          </div>
        </div>

        <!-- Pie de documento -->
        <div class="pie-documento">
          <p style="margin: 5px 0;">
            Gracias por su preferencia | www.minimarket.com | ventas@minimarket.com
          </p>
          <p style="margin: 5px 0;">
            üìû (01) 234-5678 | üì± 987-654-321 | üìç Av. Principal 123, San Isidro, Lima
          </p>
          <p style="margin: 15px 0 5px 0; font-size: 0.85rem;">
            Documento generado el 29 de Octubre, 2025 a las 10:30 AM
          </p>
        </div>
      </div>

      <!-- Secci√≥n de Acciones y Estado (No se imprime) -->
      <div class="card no-print" style="margin-top: 30px;">
        <div class="card-header">
          <h2 class="text-lg fw-600">Acciones y Seguimiento</h2>
        </div>
        <div class="card-body">
          <div class="form-row">
            <div class="col-md-6">
              <h3 class="text-md fw-600 mb-3">Cambiar Estado</h3>
              <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn btn-success" onclick="cambiarEstado('aprobada')">
                  Aprobar Cotizaci√≥n
                </button>
                <button class="btn btn-danger" onclick="cambiarEstado('rechazada')">
                  Rechazar Cotizaci√≥n
                </button>
                <button class="btn btn-warning" onclick="renovarCotizacion()">
                  Renovar Vigencia
                </button>
                <button class="btn btn-primary" onclick="convertirVenta()">
                  Convertir a Venta
                </button>
              </div>
            </div>
            <div class="col-md-6">
              <h3 class="text-md fw-600 mb-3">Otras Acciones</h3>
              <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn btn-info" onclick="editarCotizacion()">
                  Editar Cotizaci√≥n
                </button>
                <button class="btn btn-secondary" onclick="duplicarCotizacion()">
                  Duplicar Cotizaci√≥n
                </button>
                <button class="btn btn-danger" onclick="eliminarCotizacion()">
                  Eliminar Cotizaci√≥n
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Historial de la Cotizaci√≥n -->
      <div class="card no-print" style="margin-top: 20px;">
        <div class="card-header">
          <h2 class="text-lg fw-600">Historial y Seguimiento</h2>
        </div>
        <div class="card-body">
          <div class="timeline">
            <div class="timeline-item">
              <div class="timeline-marker bg-primary"></div>
              <div class="timeline-content">
                <div class="timeline-date">25/10/2025 - 10:30 AM</div>
                <div class="timeline-title">Cotizaci√≥n Creada</div>
                <div class="timeline-description">
                  Cotizaci√≥n creada por Carlos Mendoza<br>
                  Cliente: Juan P√©rez Garc√≠a<br>
                  Total: S/ 1,376.03
                </div>
              </div>
            </div>
            <div class="timeline-item">
              <div class="timeline-marker bg-info"></div>
              <div class="timeline-content">
                <div class="timeline-date">25/10/2025 - 10:35 AM</div>
                <div class="timeline-title">Cotizaci√≥n Enviada</div>
                <div class="timeline-description">
                  Enviada por correo electr√≥nico a: juan.perez@email.com<br>
                  Enviada por WhatsApp al: 987-654-321
                </div>
              </div>
            </div>
            <div class="timeline-item">
              <div class="timeline-marker bg-success"></div>
              <div class="timeline-content">
                <div class="timeline-date">25/10/2025 - 11:15 AM</div>
                <div class="timeline-title">Cotizaci√≥n Vista</div>
                <div class="timeline-description">
                  El cliente abri√≥ el correo electr√≥nico
                </div>
              </div>
            </div>
            <div class="timeline-item">
              <div class="timeline-marker bg-warning"></div>
              <div class="timeline-content">
                <div class="timeline-date">Pendiente</div>
                <div class="timeline-title">Esperando Respuesta</div>
                <div class="timeline-description">
                  V√°lida hasta: 08/11/2025 (14 d√≠as restantes)
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Informaci√≥n Adicional -->
      <div class="card no-print" style="margin-top: 20px; margin-bottom: 30px;">
        <div class="card-header">
          <h2 class="text-lg fw-600">Informaci√≥n del Cliente</h2>
        </div>
        <div class="card-body">
          <div class="form-row">
            <div class="col-md-6">
              <h3 class="text-md fw-600 mb-3">Datos del Cliente</h3>
              <p><strong>Nombre:</strong> Juan P√©rez Garc√≠a</p>
              <p><strong>Documento:</strong> DNI 45678912</p>
              <p><strong>Tel√©fono:</strong> 987-654-321</p>
              <p><strong>Email:</strong> juan.perez@email.com</p>
              <p><strong>Direcci√≥n:</strong> Av. Los Olivos 456, Lima</p>
            </div>
            <div class="col-md-6">
              <h3 class="text-md fw-600 mb-3">Historial de Compras</h3>
              <p><strong>Total Cotizaciones:</strong> 8</p>
              <p><strong>Cotizaciones Aprobadas:</strong> 6 (75%)</p>
              <p><strong>Total Comprado:</strong> S/ 12,450.00</p>
              <p><strong>√öltima Compra:</strong> 15/10/2025</p>
              <p><strong>Cliente desde:</strong> Enero 2024</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <style>
    .timeline {
      position: relative;
      padding-left: 30px;
    }

    .timeline::before {
      content: '';
      position: absolute;
      left: 10px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: var(--color-border);
    }

    .timeline-item {
      position: relative;
      margin-bottom: 30px;
    }

    .timeline-marker {
      position: absolute;
      left: -26px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 3px solid white;
      box-shadow: 0 0 0 2px var(--color-border);
    }

    .timeline-content {
      padding: 15px;
      background: var(--color-surface);
      border-radius: 8px;
      border-left: 3px solid var(--color-primary);
    }

    .timeline-date {
      font-size: 0.85rem;
      color: var(--color-text-muted);
      margin-bottom: 5px;
    }

    .timeline-title {
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 5px;
    }

    .timeline-description {
      font-size: 0.9rem;
      line-height: 1.6;
    }
  </style>

  <script>
    let cotizacionId = null;
    
    $(function(){ 
      if (!Auth.requireRole(['sucursal', 'admin', 'vendedor'])) { 
        location.href = '../index.html'; 
        return; 
      }
      
      Utils.loadComponent('#navbar', '../components/navbar.html');
      Utils.loadComponent('#sidebar', '../components/sidebar.html');
      
      // Obtener ID de la cotizaci√≥n
      const urlParams = new URLSearchParams(window.location.search);
      cotizacionId = urlParams.get('id');
      const preview = urlParams.get('preview');
      
      if (cotizacionId) {
        cargarCotizacion(cotizacionId);
      }
      
      // Si es vista previa, mostrar alerta
      if (preview) {
        $('#alertaEstado').html(`
          <div class="alert alert-info">
            <strong>Vista Previa:</strong> Esta es una vista previa de c√≥mo se ver√° la cotizaci√≥n. Los datos pueden no estar guardados a√∫n.
          </div>
        `);
      }
      
      // Verificar estado y mostrar alerta
      mostrarAlertaEstado();
    });
    
    function mostrarAlertaEstado() {
      const estado = 'pendiente'; // Esto vendr√≠a de la API
      
      let alertHtml = '';
      
      switch(estado) {
        case 'pendiente':
          alertHtml = `
            <div class="alert alert-warning mb-4">
              <strong>‚è≥ Cotizaci√≥n Pendiente:</strong> Esta cotizaci√≥n est√° esperando respuesta del cliente. 
              V√°lida hasta el 08/11/2025 (14 d√≠as restantes).
            </div>
          `;
          break;
        case 'aprobada':
          alertHtml = `
            <div class="alert alert-success mb-4">
              <strong>‚úì Cotizaci√≥n Aprobada:</strong> El cliente ha aprobado esta cotizaci√≥n. 
              Puede proceder a convertirla en una venta.
            </div>
          `;
          break;
        case 'rechazada':
          alertHtml = `
            <div class="alert alert-danger mb-4">
              <strong>‚úï Cotizaci√≥n Rechazada:</strong> El cliente ha rechazado esta cotizaci√≥n.
            </div>
          `;
          break;
        case 'vencida':
          alertHtml = `
            <div class="alert alert-secondary mb-4">
              <strong>‚åõ Cotizaci√≥n Vencida:</strong> Esta cotizaci√≥n ha expirado. 
              Puede renovar la vigencia o crear una nueva cotizaci√≥n.
            </div>
          `;
          break;
        case 'convertida':
          alertHtml = `
            <div class="alert alert-info mb-4">
              <strong>‚úì Convertida a Venta:</strong> Esta cotizaci√≥n ya fue convertida en una venta. 
              <a href="../ventas/ventas-detalle.html?id=VEN-00123" class="alert-link">Ver venta relacionada</a>
            </div>
          `;
          break;
      }
      
      $('#alertaEstado').html(alertHtml);
    }
    
    function cargarCotizacion(id) {
      Notifications.show(`Cargando cotizaci√≥n ${id}...`, 'info');
      // Aqu√≠ ir√≠a la llamada a la API para cargar los datos reales
    }
    
    function volver() {
      window.location.href = 'cotizaciones.html';
    }
    
    function enviarEmail() {
      if (confirm('¬øDesea enviar esta cotizaci√≥n por correo electr√≥nico?')) {
        Notifications.show('Enviando cotizaci√≥n por email...', 'info');
        setTimeout(() => {
          Notifications.show('Cotizaci√≥n enviada exitosamente a juan.perez@email.com', 'success');
        }, 1500);
      }
    }
    
    function enviarWhatsApp() {
      if (confirm('¬øDesea enviar esta cotizaci√≥n por WhatsApp?')) {
        Notifications.show('Enviando cotizaci√≥n por WhatsApp...', 'info');
        setTimeout(() => {
          Notifications.show('Cotizaci√≥n enviada exitosamente al 987-654-321', 'success');
        }, 1500);
      }
    }
    
    function descargarPDF() {
      Notifications.show('Generando PDF...', 'info');
      setTimeout(() => {
        Notifications.show('PDF descargado exitosamente', 'success');
        // Aqu√≠ ir√≠a la descarga real del PDF
      }, 1500);
    }
    
    function cambiarEstado(nuevoEstado) {
      let mensaje = '';
      
      switch(nuevoEstado) {
        case 'aprobada':
          mensaje = '¬øDesea aprobar esta cotizaci√≥n?';
          break;
        case 'rechazada':
          mensaje = '¬øDesea rechazar esta cotizaci√≥n?';
          break;
      }
      
      if (confirm(mensaje)) {
        Notifications.show('Actualizando estado...', 'info');
        setTimeout(() => {
          Notifications.show(`Cotizaci√≥n ${nuevoEstado} exitosamente`, 'success');
          setTimeout(() => {
            location.reload();
          }, 1000);
        }, 1500);
      }
    }
    
    function renovarCotizacion() {
      if (confirm('¬øDesea renovar la vigencia de esta cotizaci√≥n por 15 d√≠as m√°s?')) {
        Notifications.show('Renovando cotizaci√≥n...', 'info');
        setTimeout(() => {
          Notifications.show('Vigencia renovada hasta el 23/11/2025', 'success');
          setTimeout(() => {
            location.reload();
          }, 1000);
        }, 1500);
      }
    }
    
    function convertirVenta() {
      if (confirm('¬øDesea convertir esta cotizaci√≥n en una venta?\n\nSe crear√° una nueva venta con los datos de esta cotizaci√≥n.')) {
        Notifications.show('Convirtiendo a venta...', 'info');
        setTimeout(() => {
          Notifications.show('Cotizaci√≥n convertida exitosamente', 'success');
          setTimeout(() => {
            window.location.href = '../ventas/ventas-crear.html?cotizacion=' + cotizacionId;
          }, 1500);
        }, 2000);
      }
    }
    
    function editarCotizacion() {
      window.location.href = `cotizaciones-crear.html?editar=${cotizacionId}`;
    }
    
    function duplicarCotizacion() {
      if (confirm('¬øDesea crear una nueva cotizaci√≥n basada en esta?')) {
        window.location.href = `cotizaciones-crear.html?duplicar=${cotizacionId}`;
      }
    }
    
    function eliminarCotizacion() {
      if (confirm('¬øEst√° seguro de eliminar esta cotizaci√≥n?\n\nEsta acci√≥n no se puede deshacer.')) {
        Notifications.show('Eliminando cotizaci√≥n...', 'info');
        setTimeout(() => {
          Notifications.show('Cotizaci√≥n eliminada exitosamente', 'success');
          setTimeout(() => {
            window.location.href = 'cotizaciones.html';
          }, 1500);
        }, 1500);
      }
    }
  </script>
</body>
</html>